{
  "schema_version": "1.0.0",
  "generated_at": "2026-01-25T03:15:00Z",
  "source": "pg_stat_statements",
  "database_name": "production_orders",
  "host": "db-prod-01.example.com",
  "pg_version": "15.4",
  "collection_period": {
    "start_time": "2026-01-25T02:50:00Z",
    "end_time": "2026-01-25T03:10:00Z",
    "duration_seconds": 1200
  },
  "query_metrics": {
    "derived_metrics": {
      "latency_deviation_factor": 30.47,
      "cache_hit_ratio": 0.859,
      "temp_spill_detected": true,
      "slow_query_count": 89,
      "total_queries_analyzed": 1523,
      "unique_query_fingerprints": 234
    },
    "pg_stat_statements_metrics": {
      "total_calls": 42345,
      "total_time_ms": 25678900,
      "mean_time_ms": 606.3,
      "max_time_ms": 45678.9,
      "total_rows": 567890,
      "shared_blks_hit": 3456789,
      "shared_blks_read": 567890,
      "temp_blks_read": 2345,
      "temp_blks_written": 2345
    },
    "planner_executor_behavior": {
      "scan_methods": {
        "sequential_scan": {
          "detected": true,
          "frequency_percent": 65.2,
          "tables": ["orders_table", "session_tokens"]
        },
        "index_scan": {
          "detected": true,
          "frequency_percent": 34.8,
          "tables": ["customers", "inventory"]
        }
      },
      "join_strategies": {
        "nested_loop": 89234,
        "hash_join": 12453,
        "merge_join": 2345
      }
    },
    "row_estimation_accuracy": {
      "estimated_rows": 356024,
      "actual_rows": 356024,
      "estimation_error_factor": 1.0,
      "error_percent": 0.0
    },
    "query_plan_stability": {
      "plan_changed": false,
      "current_plan_hash": "xyz789",
      "baseline_plan_hash": "xyz789",
      "plan_change_reason": []
    }
  },
  "summary": {
    "total_queries_captured": 1523,
    "unique_query_fingerprints": 234,
    "slow_queries_count": 89,
    "total_execution_time_seconds": 22110.0,
    "avg_queries_per_second": 18.4
  },
  "queries": [
    {
      "query_hash": "abc123def456",
      "query_fingerprint": "SELECT * FROM orders_table WHERE customer_id = $1 AND created_at > $2",
      "normalized_query": "SELECT * FROM orders_table WHERE customer_id = ? AND created_at > ?",
      "query_type": "SELECT",
      "tables_involved": ["orders_table"],
      "indexes_involved": [],
      "calls": 1452,
      "total_exec_time_ms": 22110000.0,
      "mean_exec_time_ms": 15234.5,
      "min_exec_time_ms": 234.5,
      "max_exec_time_ms": 45678.9,
      "stddev_exec_time_ms": 8921.3,
      "rows": 356024,
      "shared_blks_hit": 1250000,
      "shared_blks_read": 89234,
      "temp_blks_read": 0,
      "temp_blks_written": 0,
      "local_blks_hit": 0,
      "local_blks_read": 0,
      "is_slow_query": true,
      "slow_query_threshold_ms": 500.0,
      "performance_score": 0.35,
      "first_detected": "2026-01-25T02:55:00Z",
      "last_detected": "2026-01-25T03:10:00Z",
      "detection_count": 47
    },
    {
      "query_hash": "def789abc123",
      "query_fingerprint": "UPDATE inventory SET quantity = quantity - $1 WHERE product_id = $2",
      "normalized_query": "UPDATE inventory SET quantity = quantity - ? WHERE product_id = ?",
      "query_type": "UPDATE",
      "tables_involved": ["inventory"],
      "indexes_involved": ["idx_inventory_product_id"],
      "calls": 8934,
      "total_exec_time_ms": 893400.0,
      "mean_exec_time_ms": 100.0,
      "min_exec_time_ms": 12.5,
      "max_exec_time_ms": 2345.6,
      "stddev_exec_time_ms": 189.2,
      "rows": 8934,
      "shared_blks_hit": 45000,
      "shared_blks_read": 12000,
      "temp_blks_read": 0,
      "temp_blks_written": 0,
      "is_slow_query": false,
      "slow_query_threshold_ms": 500.0,
      "performance_score": 0.82,
      "first_detected": "2026-01-25T02:50:00Z",
      "last_detected": "2026-01-25T03:10:00Z",
      "detection_count": 1
    },
    {
      "query_hash": "ghi456def789",
      "query_fingerprint": "INSERT INTO order_items (order_id, product_id, quantity, price) VALUES ($1, $2, $3, $4)",
      "normalized_query": "INSERT INTO order_items (order_id, product_id, quantity, price) VALUES (?, ?, ?, ?)",
      "query_type": "INSERT",
      "tables_involved": ["order_items"],
      "indexes_involved": ["idx_order_items_order_id", "pk_order_items"],
      "calls": 12453,
      "total_exec_time_ms": 498120.0,
      "mean_exec_time_ms": 40.0,
      "min_exec_time_ms": 5.2,
      "max_exec_time_ms": 567.8,
      "stddev_exec_time_ms": 78.4,
      "rows": 12453,
      "shared_blks_hit": 89000,
      "shared_blks_read": 23456,
      "temp_blks_read": 0,
      "temp_blks_written": 0,
      "is_slow_query": false,
      "slow_query_threshold_ms": 500.0,
      "performance_score": 0.91,
      "first_detected": "2026-01-25T02:50:00Z",
      "last_detected": "2026-01-25T03:10:00Z",
      "detection_count": 1
    },
    {
      "query_hash": "jkl789ghi012",
      "query_fingerprint": "SELECT COUNT(*) FROM customers WHERE last_login < $1 AND status = $2",
      "normalized_query": "SELECT COUNT(*) FROM customers WHERE last_login < ? AND status = ?",
      "query_type": "SELECT",
      "tables_involved": ["customers"],
      "indexes_involved": ["idx_customers_last_login"],
      "calls": 24,
      "total_exec_time_ms": 48000.0,
      "mean_exec_time_ms": 2000.0,
      "min_exec_time_ms": 1500.0,
      "max_exec_time_ms": 4500.0,
      "stddev_exec_time_ms": 892.1,
      "rows": 1,
      "shared_blks_hit": 45000,
      "shared_blks_read": 125000,
      "temp_blks_read": 0,
      "temp_blks_written": 0,
      "is_slow_query": true,
      "slow_query_threshold_ms": 500.0,
      "performance_score": 0.45,
      "first_detected": "2026-01-25T02:55:00Z",
      "last_detected": "2026-01-25T03:10:00Z",
      "detection_count": 8
    },
    {
      "query_hash": "mno012jkl345",
      "query_fingerprint": "SELECT p.*, c.name as customer_name FROM orders p JOIN customers c ON p.customer_id = c.id WHERE p.status = $1 ORDER BY p.created_at DESC LIMIT $2",
      "normalized_query": "SELECT p.*, c.name as customer_name FROM orders p JOIN customers c ON p.customer_id = c.id WHERE p.status = ? ORDER BY p.created_at DESC LIMIT ?",
      "query_type": "SELECT",
      "tables_involved": ["orders", "customers"],
      "indexes_involved": ["idx_orders_status", "pk_customers"],
      "calls": 5621,
      "total_exec_time_ms": 1686300.0,
      "mean_exec_time_ms": 300.0,
      "min_exec_time_ms": 45.2,
      "max_exec_time_ms": 3456.7,
      "stddev_exec_time_ms": 456.8,
      "rows": 112420,
      "shared_blks_hit": 890000,
      "shared_blks_read": 156000,
      "temp_blks_read": 125,
      "temp_blks_written": 125,
      "is_slow_query": false,
      "slow_query_threshold_ms": 500.0,
      "performance_score": 0.78,
      "first_detected": "2026-01-25T02:50:00Z",
      "last_detected": "2026-01-25T03:10:00Z",
      "detection_count": 1
    },
    {
      "query_hash": "pqr345mno678",
      "query_fingerprint": "DELETE FROM session_tokens WHERE expires_at < $1",
      "normalized_query": "DELETE FROM session_tokens WHERE expires_at < ?",
      "query_type": "DELETE",
      "tables_involved": ["session_tokens"],
      "indexes_involved": ["idx_session_tokens_expires"],
      "calls": 5,
      "total_exec_time_ms": 45000.0,
      "mean_exec_time_ms": 9000.0,
      "min_exec_time_ms": 2500.0,
      "max_exec_time_ms": 15000.0,
      "stddev_exec_time_ms": 5234.5,
      "rows": 125000,
      "shared_blks_hit": 0,
      "shared_blks_read": 45000,
      "temp_blks_read": 0,
      "temp_blks_written": 0,
      "is_slow_query": true,
      "slow_query_threshold_ms": 500.0,
      "performance_score": 0.52,
      "first_detected": "2026-01-25T03:00:00Z",
      "last_detected": "2026-01-25T03:00:00Z",
      "detection_count": 1
    },
    {
      "query_hash": "stu678pqr901",
      "query_fingerprint": "SELECT product_id, SUM(quantity) as total_sold FROM order_items GROUP BY product_id HAVING SUM(quantity) > $1 ORDER BY total_sold DESC",
      "normalized_query": "SELECT product_id, SUM(quantity) as total_sold FROM order_items GROUP BY product_id HAVING SUM(quantity) > ? ORDER BY total_sold DESC",
      "query_type": "SELECT",
      "tables_involved": ["order_items"],
      "indexes_involved": ["idx_order_items_product_id"],
      "calls": 156,
      "total_exec_time_ms": 234000.0,
      "mean_exec_time_ms": 1500.0,
      "min_exec_time_ms": 890.5,
      "max_exec_time_ms": 4500.0,
      "stddev_exec_time_ms": 789.2,
      "rows": 450,
      "shared_blks_hit": 125000,
      "shared_blks_read": 45000,
      "temp_blks_read": 1250,
      "temp_blks_written": 1250,
      "is_slow_query": true,
      "slow_query_threshold_ms": 500.0,
      "performance_score": 0.68,
      "first_detected": "2026-01-25T02:50:00Z",
      "last_detected": "2026-01-25T03:10:00Z",
      "detection_count": 12
    },
    {
      "query_hash": "vwx901stu234",
      "query_fingerprint": "WITH latest_orders AS (SELECT *, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY created_at DESC) as rn FROM orders WHERE status = $1) SELECT * FROM latest_orders WHERE rn = 1",
      "normalized_query": "WITH latest_orders AS (SELECT *, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY created_at DESC) as rn FROM orders WHERE status = ?) SELECT * FROM latest_orders WHERE rn = 1",
      "query_type": "SELECT",
      "tables_involved": ["orders"],
      "indexes_involved": ["idx_orders_customer_id", "idx_orders_status_created"],
      "calls": 2345,
      "total_exec_time_ms": 1172500.0,
      "mean_exec_time_ms": 500.0,
      "min_exec_time_ms": 125.3,
      "max_exec_time_ms": 7890.0,
      "stddev_exec_time_ms": 1123.4,
      "rows": 89234,
      "shared_blks_hit": 567000,
      "shared_blks_read": 234000,
      "temp_blks_read": 890,
      "temp_blks_written": 890,
      "is_slow_query": true,
      "slow_query_threshold_ms": 500.0,
      "performance_score": 0.61,
      "first_detected": "2026-01-25T02:55:00Z",
      "last_detected": "2026-01-25T03:10:00Z",
      "detection_count": 19
    }
  ],
  "performance_anomalies": [
    {
      "anomaly_id": "anom_001",
      "query_hash": "abc123def456",
      "anomaly_type": "HIGH_LATENCY",
      "detected_at": "2026-01-25T03:08:00Z",
      "severity": "high",
      "description": "Query latency exceeded threshold by 30x",
      "metric_name": "query_latency_ms",
      "expected_value": 500.0,
      "actual_value": 15234.5,
      "deviation_percent": 2946.9
    },
    {
      "anomaly_id": "anom_002",
      "query_hash": "pqr345mno678",
      "anomaly_type": "HIGH_LATENCY",
      "detected_at": "2026-01-25T03:00:00Z",
      "severity": "medium",
      "description": "DELETE operation took 18x longer than baseline",
      "metric_name": "query_latency_ms",
      "expected_value": 500.0,
      "actual_value": 9000.0,
      "deviation_percent": 1700.0
    }
  ],
  "index_recommendations": [
    {
      "recommendation_id": "idx_rec_001",
      "query_hash": "abc123def456",
      "table_name": "orders_table",
      "recommended_columns": ["customer_id", "created_at"],
      "index_type": "BTREE",
      "estimated_improvement_percent": 95.0,
      "estimated_size_mb": 256.0,
      "priority": "high",
      "reason": "Sequential scan detected on large table (10M+ rows)"
    },
    {
      "recommendation_id": "idx_rec_002",
      "query_hash": "vwx901stu234",
      "table_name": "orders",
      "recommended_columns": ["customer_id", "created_at"],
      "index_type": "BTREE",
      "estimated_improvement_percent": 75.0,
      "estimated_size_mb": 512.0,
      "priority": "medium",
      "reason": "Window function could benefit from covering index"
    }
  ],
  "statistics": {
    "total_shared_blks_hit": 3456789,
    "total_shared_blks_read": 567890,
    "total_temp_blks_read": 2345,
    "total_temp_blks_written": 2345,
    "avg_cache_hit_ratio": 0.859,
    "slow_query_distribution": {
      "select": 4,
      "insert": 0,
      "update": 0,
      "delete": 1
    },
    "latency_distribution": {
      "p50_ms": 45.2,
      "p90_ms": 234.5,
      "p95_ms": 567.8,
      "p99_ms": 2345.6,
      "p99_9_ms": 7890.0
    }
  }
}

